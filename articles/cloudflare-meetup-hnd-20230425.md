---
title: "Cloudflare Meetup Tokyoに参加しました"
emoji: "🗂"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["cloudflare","meetup"]
published: false
---
# はじめに

2023年4月25日にCloudflareのTokyo Meetupがあり、亀田エバンジェリストも登壇されました。
Cloudflareの考え方や仕組み、使い方をLTやハンズオンで学ぶことができました。
簡単にですが、参加した感想を書きたいと思います。

# 亀田さんの話

Cloudflareについて会社としての考え方や、高速にセキュアな通信を実現するための内部的な構造をお話しいただきました。

Cloudflareはインターネット全体の高速化をセキュアに実現するために、ネットワークを提供する会社で創立はまだ13年目です。
CDNが有名ですが、最近はエッジコンピューティングサービスも提供しており、多くのサービスが無料で使えます。もちろん有償プランもあります。
現在全世界の20%のトラフィックがCloudflareを通ると言われていて、かなりの流量がすでにCloudflareにはあるということです。
Cloudflareは大規模なデータセンターを持たず、エッジデータセンターを世界285都市で運営し、海底ケーブルの引き上げ場所にPoPを設置して、いわゆるリージョンレスという構成をしています。よりCloudflareのネットワークに入ってくる初期の段階でトラフィックを処理して、セキュアな通信のみをユーザーのオリジンに届けることで、目指すインターネットを実現しようとしています。




cloudflare：インターネットの高速化とセキュリティを提供

世界の２０％のトラフィックを管理
設立13年目

２８５都市でエッジデータセンター
リージョンレス（基本的に）
分散化したエッジセンターでトラフィックを処理して高速化して提供
日本に１０Pop
海底ケーブルの近くにPopをおく
BGPを預かって世界中のISPと接続
１９２Tbpsのネットワーク容量（DDos対策
日本は平常時３０Tbps弱
cloudflareのエラー画面はクラウドフレア使ってなくても出る

CNAMEが特殊な動きをする
DNS Proxyモードがおすすめモード
IP anycast
基本的にCDNを通して、cloudflareのネットワークに接続する構成


HTTPSは

L 3,L4のセキュリティはエッジに接続することで個別のインターネットの口を通さない
エッジ間通信は全てインターネットを通す→将来的に企業間通信もインターネットにしてコスト削減

SaaS通信もクライアント端末にアプリをインストールしてゼトトラのようなことができる


待合室SaaS


# pages/workers

workers
エッジで動作するServie workers APIの実行環境
オリジンより近くでキャッシュを返すのがエッジサーバ
そのエッジサーバそのものがworkers
JSに制限、V8エンジン、アイソレーションで最適化

KV R2 Durable Object D1 queuwsストレージと連動

ユースケース
・異なるタイプのリクエストを異なるオリジンサーバーにルーティングする
・Web APIに対応するサーバレスアプリケーションを構築する
など公式サイトにある

nodejsのAPIは動作しないが今後増える予定
HTTPのみの通信になるので、DB接続時など注意が必要

Service workerとModule workerの書き方があるので注意
ModuleのメリットAssenbllyなど使える
迷ったらhono

pages
Gitベースのデプロイフローをもつ、Jamstackサイトを構築ホストする環境
Amplifyホスティングのようなイメージ
最近はフルスタックプラットフォームへと進化
PagesFunctionsがリリース　22/11月
様々フレームワークに対応
基本的にpages利用でよくなる


# 待合室

トラストバンク

ワクチン予約の一斉通信の時にどうしようか
クラメソのプレスリリースを見かけた

クラウドフレアのアルゴリズムで予測して誘導、オリジンの状況は見ていないのは注意
上限数は任意に設定可能

ホスト・パス・アクティブユーザー上限・分単位のアクティブユーザー数・オリジンへのアクセスから撤退までの時間を設定・デザインカスタマイズも可能

困ったこと
目安待ち時間がわからない
→小さい自治体から実績調査
最適値がわからず異常な待ち時間が起きて不満に
→サーバー負荷を見ながら
不公平さ
→事前にアクセスしてると予約できてしまった
リアルタイムに待ち時間と待ち人数をSlackに通知
→これは簡単に実装できた（クラウドフレアのAPI


# ハンズオン

https://zenn.dev/kameoncloud/articles/1fac9762aab4ec

https://zenn.dev/kameoncloud/articles/7236a2c6ad35c0




# 最後に



