---
title: "EBSã®ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¿ãƒƒãƒãƒšãƒŠãƒ«ãƒ†ã‚£ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ãŸ"
emoji: "ğŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws","ebs","ec2"]
published: false
---

# ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¿ãƒƒãƒãƒšãƒŠãƒ«ãƒ†ã‚£ã¨ã¯

çš†ã•ã‚“ã¯EC2ã‚’å¾©å…ƒã—ãŸéš›ã«æ¥µç«¯ã«I/Oæ€§èƒ½ãŒè½ã¡ã¦å›°ã£ã¦ã—ã¾ã£ãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿç§ã¯ã‚ã‚Šã¾ã™ã€‚

ã¨ã„ã†ã®ã‚‚ã€EC2 AutoScalingã§ç‰¹å®šã®AMIã‚’æŒ‡å®šã—ã¦ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ãŸéš›ã«ã€ä¸€éƒ¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®é€šä¿¡ã ã‘æ¥µç«¯ã«ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ãŒé«˜ã¾ã£ã¦ã—ã¾ã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

ã“ã‚ŒãŒã€First Touch Penartyã®æ¦‚è¦ã§ã™ã€‚
ã‚‚ã†å°‘ã—è©³ç´°ã«æ›¸ãã¨ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚„AMIã‹ã‚‰EBSã‚’å¾©å…ƒã™ã‚‹éš›ã€S3ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã®ã§ã™ãŒã€ã“ã‚ŒãŒå¾©å…ƒã—ãŸæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ã¯ãªãã€ãƒ–ãƒ­ãƒƒã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã£ãŸæ™‚ã«åˆã‚ã¦ã‚³ãƒ”ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€ãƒ‡ã‚£ã‚¹ã‚¯æ€§èƒ½ãŒè‘—ã—ãä½ä¸‹ã™ã‚‹ã¨ã„ã†äº‹è±¡ã§ã™ã€‚

æ„å¤–ã¨æ°—ä»˜ã‹ãšã«ãƒãƒã‚‹ãƒã‚¤ãƒ³ãƒˆã‹ãªã¨æ€ã„ã¾ã™ã€‚

# å¯¾ç­–

ã§ã¯ã€å¯¾ç­–ã¨ã—ã¦ä½•ãŒã‚ã‚‹ã®ã‹ã¨ã„ã†ã¨ã€

- EBSã‚’ãƒªã‚¹ãƒˆã‚¢ã—ãŸæ™‚ã«å…¨ã¦ã®ãƒ‡ã‚£ã‚¹ã‚¯ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
- ã€Œ[Amazon EBSã®é«˜é€Ÿã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå¾©å…ƒ](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ebs-fast-snapshot-restore.html)ã€ã‚’ä½¿ç”¨ã™ã‚‹

é«˜é€Ÿã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå¾©å…ƒã‚’åˆ©ç”¨ã—ãŸéš›ã«ã¯æ–™é‡‘ãŒè¿½åŠ ã§ã‹ã‹ã‚‹ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚


# ã‚„ã£ã¦ã¿ãŸ

ç°¡æ˜“çš„ã«EBSã®ãƒªã‚¹ãƒˆã‚¢ã®ã¿å®Ÿæ–½ã—ã¦ã€å®Ÿéš›ã«ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚’è¡Œã£ã¦ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã‚’ç¢ºèªã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## æ¤œè¨¼ç’°å¢ƒã¨ã‚·ãƒŠãƒªã‚ª

1. Windowsã‚µãƒ¼ãƒã‚’1å°ç”¨æ„ã—ã¦ã€EBSã‚’Dãƒ‰ãƒ©ã‚¤ãƒ–(50GB:gp3)ã€Eãƒ‰ãƒ©ã‚¤ãƒ–(60GB:gp3)ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ã€‚
2. Dãƒ‰ãƒ©ã‚¤ãƒ–å´ã«30GBã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã™ã€‚
3. Eãƒ‰ãƒ©ã‚¤ãƒ–ã¸2.ã§ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€é€Ÿåº¦ã‚’è¨ˆæ¸¬ã—ã¾ã™ã€‚ï¼ˆEãƒ‰ãƒ©ã‚¤ãƒ–å´ã®ãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã—ã¾ã™ã€‚ï¼‰
4. Eãƒ‰ãƒ©ã‚¤ãƒ–ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
5. Eãƒ‰ãƒ©ã‚¤ãƒ–ã‚’ãƒ‡ã‚¿ãƒƒãƒã—ã¦ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰ä½œæˆã—ãŸãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’Dãƒ‰ãƒ©ã‚¤ãƒ–ã«ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ã€‚
6. 3.ã¨åŒæ§˜ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€é€Ÿåº¦ã‚’è¨ˆæ¸¬ã—ã¾ã™ã€‚ï¼ˆDãƒ‰ãƒ©ã‚¤ãƒ–å´ã®ãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã—ã¾ã™ã€‚ï¼‰


## æ‰‹é †

:::message
åŸºæœ¬çš„ã«ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¾ã™ãŒã€ã‚³ãƒãƒ³ãƒ‰ã¯æœ€å¾Œã«ã¾ã¨ã‚ã¦ãŠãã¾ã™ã€‚
:::

### 1. EC2ä½œæˆ

ã“ã“ã¯AWSãŒæä¾›ã™ã‚‹[ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/EC2_GetStarted.html)ç­‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ä½œæˆã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ã“ã¡ã‚‰ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/5abba844d0fe-20230701.png)

æ¥ç¶šã«é–¢ã—ã¦ã¯æœ€è¿‘ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸEC2 Instance Connect Endpointã‚’åˆ©ç”¨ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

https://dev.classmethod.jp/articles/rdp-connection-to-windows-server-using-ec2-instance-connect-endpoint-eic/

ç§ã®ãƒ­ãƒ¼ã‚«ãƒ«ã¯wsl2ä¸Šã®Ubuntu22.04ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

```bash
$ aws --version
aws-cli/2.12.6 Python/3.11.4 Linux/5.10.102.1-microsoft-standard-WSL2 exe/x86_64.ubuntu.22 prompt/off
```

ä»¥ä¸‹ã®å‡ºåŠ›ãŒã‚ã‚Œã°ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
```bash
Listening for connections on port 13389.
```

ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ã‚¢ã‚¿ãƒƒãƒã—ãŸã ã‘ã§ã¯OSã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦èªè­˜å‡ºæ¥ãªã„ãŸã‚ã€ã€Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®ç®¡ç†ã€ã‹ã‚‰ãƒã‚¦ãƒ³ãƒˆã—ã¾ã—ã‚‡ã†ã€‚

https://learn.microsoft.com/ja-jp/windows-server/storage/disk-management/assign-a-mount-point-folder-path-to-a-drive

ãƒ‡ã‚£ã‚¹ã‚¯ã®ãƒã‚¦ãƒ³ãƒˆãŒå®Œäº†ã—ãŸçŠ¶æ…‹ãŒã“ã¡ã‚‰ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/5a612dcf0462-20230701.png)


### 2. ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

Dãƒ‰ãƒ©ã‚¤ãƒ–å´ã«30GBã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
D:\>fsutil file createNew D:\dummy.data 32212254720
File D:\dummy.data is created
```

### 3. åˆå›è¨ˆæ¸¬

Powershellã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦é€Ÿåº¦ã‚’2å›è¨ˆæ¸¬ã—ã¦ã¿ã¾ã™ã€‚
```powershell
$watch = New-Object System.Diagnostics.StopWatch
$watch.Start()
Copy-Item  D:\dummy.data E:\
$watch.Stop()
$t = $watch.Elapsed
"{0} min {1}.{2} sec" -f $t.Minutes,$t.Seconds,$t.Milliseconds
```

- è¨ˆæ¸¬çµæœ

|å›æ•°|çµŒéæ™‚é–“|
|:--|:--|
|1å›ç›®|8 min 21.30 sec|
|2å›ç›®|8 min 22.501 sec|

### 4. ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå–å¾—

:::message
ç©ºã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã¯ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¿ãƒƒãƒãƒšãƒŠãƒ«ãƒ†ã‚£ãŒç™ºç”Ÿã—ãªã„ã®ã§ã€1GBã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ®‹ã—ã¦ãŠãã¾ã™ã€‚
:::

[ã“ã¡ã‚‰](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/EBSSnapshots.html)ã‚’å‚è€ƒã«ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—ã—ã¦ã„ãã¾ã™ã€‚

å¯¾è±¡ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«é·ç§»ã—ã¦ã€ã€Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ã‹ã‚‰ã€Œã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—ã€ã‚’é¸æŠã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/1991cbdf6a0b-20230701.png)

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®å–å¾—ãŒå®Œäº†ã—ã¦ã€ä½¿ç”¨å¯èƒ½ã«ãªã‚Œã°ãƒ‡ã‚¿ãƒƒãƒãƒ»å¾©å…ƒã«é€²ã¿ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/936c13d50b3e-20230701.png)




### 5. EBSãƒ‡ã‚¿ãƒƒãƒãƒ»å¾©å…ƒ

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ä½œæˆã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/0dd7c59246eb-20230701.png)

å®Œäº†ã™ã‚‹ã¨ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã—ã¦å…ƒã®çŠ¶æ…‹ã«æˆ»ã—ã¾ã—ã‚‡ã†ã€‚
![](https://storage.googleapis.com/zenn-user-upload/6fe26e5028b4-20230701.png)

ã‚¢ã‚¿ãƒƒãƒå¾Œã«OSã‹ã‚‰èªè­˜ã‚‚è¨­å®šã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãšã«ã€‚


### 6. å†ã‚¢ã‚¿ãƒƒãƒå¾Œè¨ˆæ¸¬

å†åº¦3.ã®æ‰‹é †ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ”ãƒ¼ã®è¨ˆæ¸¬ã‚’ã—ã¦ã¿ã¾ã™ã€‚

- è¨ˆæ¸¬çµæœ

|å›æ•°|çµŒéæ™‚é–“|
|:--|:--|
|1å›ç›®||
|2å›ç›®||


# ã¾ã¨ã‚

æ„å¤–ã¨ãƒãƒã‚‹ã“ã¨ã®å¤šã„ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¿ãƒƒãƒãƒšãƒŠãƒ«ãƒ†ã‚£ã«ã¤ã„ã¦ã€æ¤œè¨¼ã‚‚å«ã‚ã¦ã¾ã¨ã‚ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚
å„æ‰€ã§ç™ºç”Ÿã—ãŸã€ã—ãªã‹ã£ãŸãªã©ã®æƒ…å ±ãŒæ›–æ˜§ã«ãªã£ã¦ã„ã¾ã™ãŒã€å¸¸ã«å¯èƒ½æ€§ã¨ã—ã¦ã¯ã‚ã‚‹ã‚‚ã®ãªã®ã§ã€æ°—ã«ãªã‚‹æ–¹ã¯ç¢ºå®Ÿã«ãƒªã‚¹ãƒˆã‚¢å¾Œã«ãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãŠãã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚
è²»ç”¨ã‚’ã‹ã‘ãŸããªã‘ã‚Œã°ã€ddã‚³ãƒãƒ³ãƒ‰ã§ã®ãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’å®Ÿæ–½ã—ã¦ãŠãã“ã¨ã‚’ãŠã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚RunCommandã‚„bashç­‰ãŒå€™è£œã«ãªã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

ã“ã“ã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
ä»Šå›ã®æ¤œè¨¼ã§é–¢ä¿‚ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒªã‚¹ãƒˆã‚’ä»¥ä¸‹ã«ã¾ã¨ã‚ã¦ãŠãã¾ã™ã®ã§ã€CLIã§ã‚„ã‚ŠãŸã„ã¨ã„ã†æ–¹ã¯ã“ã¡ã‚‰å‚ç…§ã—ã¦ãã ã•ã„ã€‚



# å‚è€ƒï¼ˆã‚³ãƒãƒ³ãƒ‰ï¼‰

### snapshotä½œæˆ

```bash
aws ec2 describe-volumes
aws ec2 create-snapshot --volume-id <volume_id> --tag-specification 'ResourceType=snapshot, Tags=[{Key=Name,Value=testsnapshot}]' --description "test"
```

https://docs.aws.amazon.com/cli/latest/reference/ec2/create-snapshot.html


### EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ãƒ‡ã‚¿ãƒƒãƒ

```bash
aws ec2 detach-volume --volume-id <volume_id>
```

https://docs.aws.amazon.com/cli/latest/reference/ec2/detach-volume.html


### Snapshotã‹ã‚‰ãƒªã‚¹ãƒˆã‚¢

```bash
aws ec2 create-volume --snapshot-id <snapshot_id> --volume-type gp3 --availability-zone ap-northeast-1a
```

https://docs.aws.amazon.com/cli/latest/reference/ec2/create-volume.html


### EC2ã«ã‚¢ã‚¿ãƒƒãƒ

```bash
aws ec2 attach-volume --device <device> --instance-id <instance_id> --volume-id <volume_id>
```

https://docs.aws.amazon.com/cli/latest/reference/ec2/attach-volume.html



