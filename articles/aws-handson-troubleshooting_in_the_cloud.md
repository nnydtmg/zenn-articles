---
title: "AWS Support - Troubleshooting in the cloud Workshopã‚’ã‚„ã£ã¦ã¿ãŸ"
emoji: "ğŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws","cloudwatch","devops","operation"]
published: false
---
# AWS Support - Troubleshooting in the cloudã¨ã¯
AWSãŒæä¾›ã™ã‚‹Workshopã®ä¸€ã¤ã§ã€ç¾åœ¨(2023/12)ã¯è‹±èªç‰ˆãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚(ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒå¤šã‘ã‚Œã°æ—¥æœ¬èªåŒ–ã‚‚å¯¾å¿œã—ãŸã„ã¨ã®ã“ã¨)
ã‚¯ãƒ©ã‚¦ãƒ‰ã¸ã®ç§»è¡ŒãŒé€²ã‚€ä¸­ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¤‡é›‘æ€§ã‚‚å¢—ã—ã¦ã„ã¾ã™ã€‚ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã§ã¯æ§˜ã€…ãªãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã«å¯¾å¿œã§ãã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å­¦ã¶ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚AWSã ã‘ã§ãªãä¸€èˆ¬çš„ãªãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã‚‚ç¹‹ãŒã‚‹çŸ¥è­˜ãŒå¾—ã‚‰ã‚Œã‚‹ãŸã‚ã€éå¸¸ã«ãŸã‚ã«ãªã‚‹Workshopã‹ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«åˆ†ã‹ã‚Œã¦ã„ã‚‹ã®ã§ã€èˆˆå‘³ã®ã‚ã‚‹åˆ†é‡ã ã‘å®Ÿæ–½ã™ã‚‹ã¨ã„ã†ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

https://catalog.us-east-1.prod.workshops.aws/workshops/fdf5673a-d606-4876-ab14-9a1d25545895/en-US/introduction

å­¦ç¿’ã§ãã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ»ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨ã—ã¦ã¯ã€CI/CDã€IaCã€Serverlessã€ã‚³ãƒ³ãƒ†ãƒŠã€Networkã€Databaseç­‰ã®ã‚·ã‚¹ãƒ†ãƒ ã«é–¢ã‚ã‚‹å…¨ã¦ã®ãƒ¬ã‚¤ãƒ¤ãŒç¶²ç¾…ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãœã²ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

ã“ã“ã‹ã‚‰ã¯å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«ã¾ã¨ã‚ã¦ã„ãã¾ã™ã®ã§ã€èˆˆå‘³ã®ã‚ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã¨ã‚“ã§ãã ã•ã„ã€‚
ãªãŠã€ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å‰æä½œæ¥­ã¯ã€Self-Paced Labã®ã‚¿ãƒ–ã‹ã‚‰å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãªã©ã‚’ã—ã¦ãã ã•ã„ã€‚


# DevOps and Serverless Troubleshooting

ã“ã®ã‚³ãƒ¼ã‚¹ã§ã¯DevOpsã¨Serverlessã«é–¢ã™ã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚
CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¨ãƒ©ãƒ¼ã‚„Serverlessã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨¼åƒçŠ¶æ³ç¢ºèªãªã©ã€é–‹ç™ºã‹ã‚‰ãƒªãƒªãƒ¼ã‚¹ã¾ã§ã‚’ã‚¹ã‚³ãƒ¼ãƒ—ã«å¯¾å¿œã—ã¦ã„ãã¾ã™ã€‚

:::message
ã“ã®ç« ã¯ç„¡æ–™åˆ©ç”¨æ å¤–ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã€ã‚³ã‚¹ãƒˆãŒæ°—ã«ãªã‚‹æ–¹ã¯æ³¨æ„ã—ã¦å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚
:::

CloudFormationãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã‚‹çŠ¶æ…‹ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™ã€‚CodePipelineã®ãƒªã‚½ãƒ¼ã‚¹ãŒæ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

:::message alert
Templateã§Cloud9ã‚’æ§‹ç¯‰ã™ã‚‹ã®ã§ã€default VPCã‚’å‰Šé™¤ã—ã¦ã„ã‚‹æ–¹ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã®è‡ªå‹•å‰²å½“ã‚’æœ‰åŠ¹åŒ–ã—ãŸSubnetã‚’è¿½åŠ ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚
C9IDE:
  SubnetId: !Sub 'subnet-xxxxxxxxxxxx'
ã¾ãŸã€IAMã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆã¯è©²å½“è¡Œã‚’å‰Šé™¤ã™ã‚Œã°ã†ã¾ãã„ãã®ã§ä¿®æ­£ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
:::

## æ¦‚è¦

CloudFormationã§æ§‹ç¯‰ã—ãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ã¯ã€ä»¥ä¸‹ã®ãƒªã‚½ãƒ¼ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

|ã‚¹ãƒ†ãƒ¼ã‚¸|ãƒªã‚½ãƒ¼ã‚¹|
|:--|:--|
|source|Code Commit|
|build|Code Build|
|deploy|Code Deploy|

ã“ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä¸­ã§API Gatewayã‹ã‚‰Lambdaãƒ»DynamoDBç­‰ã‚’SAM^[[AWS Serverless Application Model](https://docs.aws.amazon.com/ja_jp/serverless-application-model/latest/developerguide/what-is-sam.html)]ã‚’ä½¿ã£ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã¾ã™ã€‚

å„å•é¡Œã«å…±é€šã—ã¦ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’æ„è­˜ã—ãªãŒã‚‰å•é¡Œè§£æ±ºã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

* ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ä½•ã‚’ã—ã¾ã™ã‹?ãªãœå¤±æ•—ã—ãŸã®ã§ã™ã‹? (å•é¡Œã‚’å®šç¾©ã™ã‚‹)
* å•é¡ŒãŒç‰¹å®šã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ®µéšã¾ãŸã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ã‚‹ã®ã‹ã©ã†ã‹ã‚’ç‰¹å®šã§ãã¾ã™ã‹? ï¼ˆæ¶ˆå»ã®éç¨‹ï¼‰
* ã‚¹ãƒ†ãƒ¼ã‚¸ãŒå¤±æ•—ã™ã‚‹ç†ç”±ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã¯ã‚ã‚Šã¾ã™ã‹? (å¯è¦³æ¸¬æ€§)
* ç‰¹å®šã®ä¸€é€£ã®ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰å•é¡Œã®æ ¹æœ¬åŸå› ã‚’çµã‚Šè¾¼ã‚€ã“ã¨ã¯ã§ãã¾ã™ã‹? (ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®æ§‹ç¯‰)


## Issue 1

PipeLineãŒå¤±æ•—ã—ã¦ã„ã‚‹ã®ã§ã€è§£æ±ºã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/fd79c3902257-20231226.png)

ã¾ãšã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¢ºèªã§ã™ã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®SourceActionã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚

> The action failed because no branch named mainline was found in the selected AWS CodeCommit repository SampleRepo. Make sure you are using the correct branch name, and then try again. Error: null

ã¤ã¾ã‚Šã€CodeCommitã«æŒ‡å®šã—ãŸãƒ–ãƒ©ãƒ³ãƒãŒè¦‹ã¤ã‹ã‚‰ãªã„ã¨è¨€ã‚ã‚Œã¦ã„ã¾ã™ã€‚ä»Šå›ã¯Cfnãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä¸­ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å®šç¾©è‡ªä½“ã‚‚è¡Œã£ã¦ã„ã‚‹ã®ã§ã€ã“ã“ã‚’æ›´æ–°ã—ã¦ã„ãã¾ã™ã€‚
ApplicationPipelineãƒªã‚½ãƒ¼ã‚¹ã®ä¸­ã®Stages > Actions > Configurationã®ä¸­ã®BranchNameã‚’æ­£ã—ã„å€¤ã«ä¿®æ­£ã—ã¾ã—ã‚‡ã†ã€‚

```diff yaml
- BranchName: mainline
+ BranchName: main
```

ã“ã®çŠ¶æ…‹ã§Cfnã‚¹ã‚¿ãƒƒã‚¯ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç½®æ›æ›´æ–°ã—ã¾ã™ã€‚
å®Œäº†ã™ã‚‹ã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸ã®iã‚¢ã‚¤ã‚³ãƒ³ã‹ã‚‰æƒ…å ±ã‚’å‚ç…§ã™ã‚‹ã¨ã€æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/441591f4edb4-20231226.png)

ç”»é¢å³ä¸Šã®ã€Œå¤‰æ›´ã‚’ãƒªãƒªãƒ¼ã‚¹ã€ã‚’æŠ¼ä¸‹ã™ã‚‹ã¨ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Ÿè¡Œã•ã‚Œæ­£å¸¸çµ‚äº†ã™ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/3d90e929340e-20231226.png)

ã“ã‚Œã§Issue1ã¯å®Œäº†ã§ã™ã€‚

## Issue 2

Issue1ã§å®Ÿè¡Œã—ãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå¤±æ•—ã—ã¦ã„ã‚‹ã®ã§ã€å†…å®¹ã‚’ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚ä½•ã¯ã¨ã‚‚ã‚ã‚Œãƒ­ã‚°ã®ç¢ºèªã‹ã‚‰ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/418e1bd4a372-20231226.png)

![](https://storage.googleapis.com/zenn-user-upload/517f4accee23-20231226.png)

ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€serverless-guard-checkã§æŒ‡å®šã•ã‚ŒãŸLambdaãƒãƒ³ãƒ‰ãƒ©ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç¢ºèªã—ã¾ã™ã€‚
```
serverless-guard-check/aws_serverless_function       FAIL
ãƒ»ãƒ»ãƒ»
 Error            = Check was not compliant as property [/Resources/putItemFunction/Properties/Handler[L:86,C:15]] was not present in [(resolved, Path=[L:0,C:0] Value=["src/get-by-id.getByIdHandler","src/get-all-items.getAllItemsHandler","src/put-item.putItemHandler"])]
```

SAMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã™ãŒã€ã“ã‚Œã¯Cloud9ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã«æ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚
**putItemFunction** ã®Handlerãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ **putItemHandler** ã«å¤‰æ›´ã—ã¾ã™ã€‚
ãã®ã†ãˆã§Gitãƒªãƒã‚¸ãƒˆãƒªã«åæ˜ ã•ã›ã¦ã¿ã¾ã™ã€‚

å†åº¦ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒèµ·å‹•ã—ã€ã†ã¾ãBuildã•ã‚Œã‚Œã°å®Œäº†ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/d9547fc126b6-20231226.png)

Issue2ã¯å®Œäº†ã§ã™ã€‚

## Issue 3

ç¶šã„ã¦ã¯Deployã‚¹ãƒ†ãƒ¼ã‚¸ãŒå¤±æ•—ã—ã¦ã„ã‚‹ã®ã§ã€ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/fab5b241dc36-20231226.png)

ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã¨ã€S3Bucketã¨ã„ã†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å•é¡ŒãŒã‚ã‚Šãã†ã§ã™ã€‚

> Parameters: [S3Bucket] must have values (Service: AmazonCloudFormation; Status Code: 400; Error Code: ValidationError; Request ID: 2169c3c0-28db-48e4-82bc-ed67f3ec1221; Proxy: null)

å®šç¾©ã®ä»•æ–¹ã«ã‚‚ã‚ˆã‚Šã¾ã™ãŒã€ä»Šå›ã¯Cfnã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®šç¾©ã—ã¦ã„ã¦ã€å„ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸ã«ãŠã‘ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®é€£æºãŒã†ã¾ãã§ãã¦ã„ãªã„ã“ã¨ãŒåŸå› ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚
Cfnãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä¸­ã§**ParameterOverrides** ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€å‹•çš„ã«å€¤ã‚’æ¸¡ã™ã“ã¨ãŒå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§Cfnãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã€‚

```diff
Capabilities: 'CAPABILITY_IAM,CAPABILITY_NAMED_IAM,CAPABILITY_AUTO_EXPAND'
+ ParameterOverrides: !Sub '{"S3Bucket": "${pipelineArtifactStore}"}' 
RoleArn: !GetAtt
```

æ›´æ–°å¾Œå†åº¦Cfnã‚¹ã‚¿ãƒƒã‚¯ã‚’æ›´æ–°ã—ã€ã€Œå¤‰æ›´ã‚’ãƒªãƒªãƒ¼ã‚¹ã€ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä¸Šæ‰‹ããƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Œäº†ã™ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/963a445abafb-20231226.png)

ã“ã‚Œã«ã¦DevOps and Serverless Troubleshootingã®ç« ã¯å®Œäº†ã§ã™ã€‚

# Containers Troubleshooting


# Networking and Web Services troubleshooting


# Database troubleshooting


# Additional Learning



